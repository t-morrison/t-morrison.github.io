<!DOCTYPE html>
<html>
	<head>
		<title>TRM</title>
		<meta charset="utf-8">
		 
		<script src="https://d3js.org/d3.v4.min.js"></script>
		<link rel="shortcut icon" type="image/x-icon" href="favicon[1].ico">
		<link rel="stylesheet" type="text/css" href="css/main.css">
		<style>
			#sidebar {
				position: absolute;
				right: 0;
				width: 0%;
				height: 100%;
				z-index: 100;
				<!-- pointer-events: none -->
			}
		</style>
	</head>
	<body>
		<!-- <div id="sidebar"></div> -->
		<nav>
    		<ul>
        		<li><a href="/">Home</a></li>
	        	<li><a href="pages/about.html">About</a></li>
				<li><a href="pages/resume.pdf">Resume</a></li>
        		
    		</ul>
		</nav>
		<div> Welcome! <br> hover over the circles to see the projects <br>and click to view the projects </div>
		
		<div id='list'></div>
		
		<div id='plot'></div>
		<button type="button" onclick="toggle(state)">Toggle view</button>
		<button type="button" onclick="test()">TEST</button>
		
		<div><p> </p></div>
		<footer>
    		<ul>
        		<li><a href="mailto:thomas.r.morrison@gmail.com">email</a></li>
        		<li><a href="https://github.com/moman822">github.com/moman822</a></li>
			</ul>
		</footer>
		
		
		
		<script>
			
			function openInNewTab(url) {
			  var win = window.open(url, '_blank');
			  win.focus();
			}
			
			function split(left, right, parts) {
				var result = [],
					delta = (right - left) / (parts - 1);
				while (left < right) {
					result.push(left);
					left += delta;
				}
				result.push(right);
				return result;
			}

			
			var dat
			var links
			var groupScale		
						
			var width = document.documentElement.clientWidth * (2/3)
			var height = 560
			
			var svg = d3.select("#plot")
			  .append("svg")
				.attr("width", width)
				.attr("height", height)
			
			var state = 'circle'
			var toggle
			var test
			
			
			d3.csv('links.csv', function(data) {
				links = data
			})
			
			d3.csv('data.csv', function(data) {
				console.log(data)
				dat = data
							
		//=================================================================================================
		//=================================================================================================
				toggle = function(st) {
				
					if(st=='circle'){
						console.log('circle to list')
						
						d3.selectAll('.node')
							.transition()
							.delay(250)
							.duration(500)
							.attr('r', 0)
						
						
						var list_g = svg.append('g')
							.selectAll('circle')
							.data(dat.sort(function(x, y){
								return d3.ascending(x.section, y.section);
							}))
							.enter()
						
						list_g.append('circle')
								.attr('class', 'list')
								.attr('cx', 10)
								.attr('cy', function(d, i){ return 120 + (i * 25) })
								.attr('r', 0)
								.style("fill", function(d){ return colorScale(d.section)})
								.style("fill-opacity", 0.8)
								.attr("stroke", "black")
								.style("stroke-width", 1)
								.transition()
								.delay(250)
								.duration(500)
									.attr('r', 5)
						
						list_g.append('text')
								.attr('class', 'list')								
								.attr('x', 22)
								.attr('y', function(d, i){ return 126 + (i*25)})
								.style('opacity', 0)
								.html(function(d){ return '<a href="'+d.path+'" target="_blank">' +d.name+'</a>' })
								.transition()
								.delay(250)
								.duration(500)
									.style('opacity', 1)
							
						state = 'list'
					} else {
						console.log('list to circle')
						
						d3.selectAll('.node')
							.transition()
							.delay(250)
							.duration(500)
							.attr("r", function(d){ return size(d.coolness)})
							
						d3.selectAll('.list')
							.transition()
							.delay(250)
							.duration(500)
							.attr("r", 0)
							.style('opacity', 0)
							.remove()
						
						
						state = 'circle'
					}
					
				}
		//=================================================================================================
		//=================================================================================================
				var Tooltip = d3.select("#plot")
					.append("div")
					.style("opacity", 0)
					.attr("class", "tooltip")
					.style('max-width', "325px")
					.style("display","inline-block")
					.style('position', 'absolute')
					.style("background-color", "white")
					.style("border", "solid")
					.style("border-width", "2px")
					.style("border-radius", "5px")
					.style("padding", "5px")
		//=================================================================================================
		//=================================================================================================
		
		//=================================================================================================
		//=================================================================================================
				groupScale = d3.scaleOrdinal()
					.domain(d3.map(dat, function(d){return d.section;}).keys().sort())
					.range(split(0, width/3, (d3.map(dat, function(d){return d.section;}).keys().length)))
					
				var colorScale = d3.scaleOrdinal()
					.domain(d3.map(dat, function(d){return d.section;}).keys())
					//.range(["55dde0","33658a","2f4858","f6ae2d","f26419"])
					.range(["fff009","32b0ff","ed5021","1adbd8","ff14a5"])
				
				size = d3.scaleLinear()
					.domain([0, 6])
					.range([7,40])
		
		//=================================================================================================
		//=================================================================================================	  
		
				
		//=================================================================================================
		//=================================================================================================
				
				var link = svg.append('g')
					.selectAll("line")
					.data(links)
					.enter()
					.append("line")
					  .style("stroke", "black")
				
				
				node = svg.append("g")
					.selectAll("circle")
					.data(dat)
					.enter()
					.append("g")
					//  .attr("class", "node")
					.attr("class", function(d) {
						return d.shape + " node";
					})
					.call(d3.drag()
					   .on("start", dragstarted)
					   .on("drag", dragged)
					   .on("end", dragended)) 
				
				
				var rh = 70
				var rw = 70
				
				d3.selectAll('.rect').append('rect')
					.attr('width', rw)
					.attr('height', rh)
					.attr('fill', 'white')
					.attr('stroke', 'black')
					.attr('x', -rw/2)
					.attr('y', -rh/2)
					.attr('rx', 5)
					.attr('ry', 5)
				
				d3.selectAll('.rect').append('text')
					.attr('x', 0)
					.attr("y", 4)
					.style("text-anchor", "middle")
					.html(function(d){ return ''+d.name+'' })
					//.html(function(d){ return '<a href="'+d.path+'" target="_blank">' +d.name+'</a>' })
				
				d3.selectAll('.circle').append('circle')
					  .attr("r", function(d){ return size(d.coolness)})
					  //.attr("cx", width / 2)
					  //.attr("cy", height / 2)
					  .style("fill", function(d){ return colorScale(d.section)})
					  .style("fill-opacity", 1)
					  .attr("stroke", "black")
					  .style("stroke-width", 1)
					  .on("mouseover", function(d){
							Tooltip
								.style("opacity", 1)
								.style('z-index', 1)
							
							d3.select(this)
								.style('stroke-width', 3)
					  })
					  .on("mousemove", function(d){
							
							Tooltip
							  .html('<b>' + d.name + '</b><br><i>click to open</i><br>'+d.blurb)
							  .style("left",(d3.event.pageX+10+"px"))//d3.mouse(this)[0]+400) + "px")
							  .style("top", (d3.event.pageY+"px"))//d3.mouse(this)[1]+height) + "px")	
							
					  })
					  .on("mouseleave", function(d){
							Tooltip
								.style("opacity", 0)
								.style('z-index', -1)
						
							d3.select(this)
								.style('stroke-width', 1)
						
					  })
					  .on('click', function(d){
						openInNewTab(d.path)
						
						d3.select(this)
							.style('opacity', .5)
						
					  })
					
				
				
				
				
			  // Features of the forces applied to the nodes:
				simulation = d3.forceSimulation()
					.force("link", d3.forceLink().id(function(d) { return d.id; }))
					//.force("x", d3.forceX().strength(0.9).x( function(d){ return groupScale(d.section) } ))
					//.force("y", d3.forceY().strength(0.4).y( height/2 ))
					.force("center", d3.forceCenter().x(width / 2).y(height / 2)) // Attraction to the center of the svg area
					.force("charge", d3.forceManyBody()
						.strength(-400)
						.theta(0.1)
						.distanceMax(350)
					)//.strength(.1)) // Nodes are attracted one each other of value is > 0
					.velocityDecay(0.9)
					.force("collide", d3.forceCollide().strength(1).radius(60).iterations(1)) // Force that avoids circle overlapping
					//.force("center", d3.forceCenter(width / 2, height / 2));
					
				
				
			  ////Apply these forces to the nodes and update their positions.
			  // Once the force algorithm is happy with positions ('alpha' value is low enough), simulations will stop.
				simulation
					.nodes(dat)
					.on("tick", function(d){
						var radius = 40
						node.attr("transform", function (d) {							
							var xpos = Math.max(radius, Math.min(width - radius, d.x))							
							var ypos = Math.max(radius, Math.min(height - radius, d.y))
							return "translate(" + xpos + "," + ypos + ")";
						})
						
						link
							.attr("x1", function(d) { return Math.max(radius, Math.min(width - radius, d.source.x))})//d.source.x; })
							.attr("y1", function(d) { return Math.max(radius, Math.min(width - radius, d.source.y))})//d.source.y; })
							.attr("x2", function(d) { return Math.max(radius, Math.min(width - radius, d.target.x))})//d.target.x; })
							.attr("y2", function(d) { return Math.max(radius, Math.min(width - radius, d.target.y))})//d.target.y; });
						//node
						//	.attr("cx", function(d){ return d.x; })
						//	.attr("cy", function(d){ return d.y; })
							
						//node.attr("transform", function (d) {
						//	return "translate(" + d.x + "," + d.y + ")";
						//});					
						
					})
				
				simulation.force("link")
					.links(links)
					
				
			  // What happens when a circle is dragged?
				function dragstarted(d) {
					if (!d3.event.active) simulation.alphaTarget(.03).restart();
					d.fx = d.x;
					d.fy = d.y;
				}
				function dragged(d) {
					d.fx = d3.event.x;
					d.fy = d3.event.y;
				}
				function dragended(d) {
					if (!d3.event.active) simulation.alphaTarget(.03);
					d.fx = null;
					d.fy = null;
				}
		//=================================================================================================
		//=================================================================================================
		
		//=================================================================================================
		//=================================================================================================
				var legendRectSize = 18
				var legendSpacing = 4
				
				var legend = svg.selectAll('.legend')
				  .data(d3.map(dat, function(d){return d.section;}).keys().slice(0,3).sort())
				  .enter()
				  .append('g')
				  .attr('class', 'legend')
				  .attr('transform', function(d, i) {
					var height2 = legendRectSize + legendSpacing
					var offset =  -200//-height
					var horz =  width - 120
					var vert = (i * height2) - offset - (6*height2)
					return 'translate(' + horz + ',' + vert + ')'
				  })
                
				legend.append('rect')
				  .attr('width', 20)
				  .attr('height', 20)
				  .style('fill', function(d){return colorScale(d)})
				  
				  
				legend.append('text')
				  .attr('x', -5)
				  .attr('y', legendRectSize - legendSpacing)
				  .style("text-anchor", "end")
				  .text(function(d) { return d })
		//=================================================================================================
		//=================================================================================================
			})	
			
		</script>
	</body>
</html>












