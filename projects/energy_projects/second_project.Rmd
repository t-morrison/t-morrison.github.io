---
title: "REnewable Energy Production in the United States"
author: "T. Morrison"
date: "April 4, 2016"
output: html_document
---

```{r setup, include=FALSE, dev='CairoPNG'}
knitr::opts_chunk$set(echo = TRUE)
```
For this post, I wanted to dive deeper into the US energy production data set from the EIA, and look closer at share of energy production by source. I loaded the data in the same way as the previous post, so that won't be shown.

Packages:
```{r, message=FALSE, warning=FALSE}
library(readxl)
library(tidyr)
library(dplyr)
library(ggplot2)
library(data.table)
library(scales)
library(ggthemes)
```

```{r, eval=TRUE, include=FALSE}
GenerationByState<- read_excel("C:/Users/tmo/Desktop/R/energygenerationbystate.xls", skip=1)
names(GenerationByState) <- c("Year","State","Producer","Source","Mwhs")
```
```{r, include=FALSE}
State <- filter(GenerationByState, Producer=="Total Electric Power Industry")

Midwest <- filter(GenerationByState, State %in% c("IL","OH","WI","ND","SD","NE","KS","IA","MN","IN","MO","MI"))
Northeast <- filter(GenerationByState, State %in% c("CT","ME","MA","NH","RI","VT","NJ","NY","PA"))
West <- filter(GenerationByState, State %in% c("AZ","CO","ID","MT","NV","NM","UT","WY","AK","CA","HI","OR","WA"))
South <- filter(GenerationByState, State %in% c("AL","KY","MS","TN","AR","LA","OK","TX","DE","FL","GA","MD","NC","SC","VA","WV", "DC"))

tepiMW <- filter(Midwest, Producer=="Total Electric Power Industry")
tepiNE <- filter(Northeast, Producer=="Total Electric Power Industry")
tepiW <- filter(West, Producer=="Total Electric Power Industry")
tepiS <- filter(South, Producer=="Total Electric Power Industry")
function2 <- function(df) {
              x <- data.table(df)
              y<-x[,.(SourceSum=sum(Mwhs), Region=Region), by=.(Source, Year)]
              y
}

tepiMW$Region <- "MW"
tepiS$Region <- "S"
tepiNE$Region <- "NE"
tepiW$Region <- "W"

list <- list(tepiMW,tepiNE,tepiW,tepiS)
list2 <- lapply(list, function2)
TotalsRegion<-rbind(list2[[1]], list2[[2]], list2[[3]], list2[[4]])
TotalsRegion <- unique(TotalsRegion)

```

In the last post, I put together some plots that looked at energy production in the US by source and across the four US Census Bureau regions.

Energy production in the entire US by source:

```{r, fig.width=10}
UStotal<-TotalsRegion[, .(USsource=sum(SourceSum)), by=.(Source,Year)]
  
ggplot(UStotal, aes(x=Year, y=USsource/1000000000, col=Source)) +
  geom_line(size=.6) +
  scale_y_continuous(labels=scales::comma) +
  ggtitle("US Energy Production by Source, 1990-2014") + ylab("Billion Mwhs")
```

Takeaways:

* Total energy production has stayed flat since about 2005
* Coal as a source of energy has been falling since 2007
* Wind has been steadily increasing as a source of energy since 2006
* Natural Gas has steadily risen as a source of energy since the beginning of the data

To get started, I'm going to have a look at the renewable energy sources as a share of total energy production in the US and within each region. Since the data I have doesn't contain that information explicitly, I had to figure out a way to come up with it.

The data contains energy production data in megawatt hours for thirteen distinct energy sources:
```{r}
unique(TotalsRegion$Source)
```

For this exploration, I am considering hydroelectric, other biomass, wind, wood, solar, and geothermal as the renewable energy sources.

```{r}
renewables<-c("Hydroelectric Conventional","Geothermal","Other Biomass","Solar Thermal and Photovoltaic","Wind","Wood and Wood Derived Fuels")
```


To get renewable energy production as a fraction of total energy production, I need to, for each year, sum the megawatt hours produced for all renewable sources then divide by the total energy production for that year. To do this, I utilized the data.table package and its powerful subsetting capabilities.

The following function accomplishes this, as the third line allows me to perform the calculations in the second line by each unique `Year` value and by `Region`. `SourceSum` is the value for megawatt hours produced and `renewables` is a character vector containing the renewable energy source names.

```{r}
TotalsRegionRenew <- TotalsRegion[,                                         
                                  sum(SourceSum[Source %in% renewables]) / SourceSum[Source=="Total"],
                                  by = .(Year, Region)]
```


So, for every unique `Year` and `Region`, all the mwhs of observations of type renewables are summed then divided by the mwhs value for the `Total` observation. The resulting dataset includes the year variable, the region, and the fraction of total energy produced by renewable sources.

These variables plotted by region plus an average for the entire US:

```{r, fig.width=10}
ggplot(TotalsRegionRenew, aes(x=Year, y=V1)) +
  geom_line(size=1, aes(col=Region)) +
  geom_line(data=TotalsRegionRenew[,sum(V1)/4, by=.(Year)],
            aes(x=Year, y=V1, col="USA"), size=1.1) +
  scale_y_continuous(limits=c(0:1), labels=scales::percent) +
  ggtitle("Renwable Energy Production in the United States") + ylab("Percent of Energy Production") +
  xlab("Year")

```


How can renewable energy not have increased its share of US energy production in the last twenty-five years?

Well,overall energy production has increased a lot since 1990, about 33% according to the first plot in this post. So, renewable energy production has to have grown a considerable amount since 1990 just to keep pace with that. And we also see in the second plot, as well as in the previous post, that hydroelectric energy, by far the biggest renewable source in the country, has not increased, aside from annual fluctuations, since 1990. Ergo, to maintain its share of the energy production, other renewable sources needed to grow a considerable amount since 1990.


