<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">

		<title>Bar chart</title>

	    <script src="https://d3js.org/d3.v4.min.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
	
	</head>

	<body>
		
		
		<script type="text/javascript">
			
			var dataset = [ 5, 10, 13, 19, 21, 25, 22, 18, 15, 13,
							11, 12, 15, 20, 18, 17, 16, 18, 23, 25 ];
		
			d3.select('body').style('overflow','hidden') //.style('position', 'absolute').style('height','100%')
				.append('svg')
				.style('position','absolute').attr('height', '100%').attr('width', '100%')
				.selectAll('rect')
				.data(dataset)
				.enter()
				.append('rect')
				.attr('x', function(d, i) {return i * (100 / dataset.length) + '%'})
				.attr('y', function(d) {return 100 - d + '%'})
				.attr('fill','blue')
				.attr('height', function(d) {return d + '%'})
				.attr('width', 100 / dataset.length - 1 + '%');
				
			//d3.select('svg')
			//	.append('circle')
			//	.attr('cx','50%').attr('cy','50%').attr('r','5%').attr('fill','maroon')
			//	.transition()
			//	.duration(1000)
			//	.attr('cx', dataset * (100 / dataset.length) + '%')
			//	.attr('cy', function(d) {return 100 - d + '%'});
				
			d3.select('svg')
				.selectAll('text')
				.data(dataset)
				.enter()
				.append('text')
				.text(function(d) {return d})
				.attr('text-anchor','middle')
				.attr('x', function(d,i) {return (i * 100 / dataset.length) + ((100 / dataset.length-1)/2) + '%'})
				.attr('y', function(d) {return 100 - d + 2 + '%'})
				.attr('fill','white');
				
			d3.selectAll('rect')
				.transition()
				.duration(2000)
				.attr('height', '0%')
				.on('end', function() {d3.select(this)
												.attr('fill','red')
												.transition()
												.duration(2000)
												.attr('height', function(d) {return d * 2 + '%'})
												.attr('y', function(d) {return 100 - (d*2) + '%'});
									   d3.selectAll('text')
											.transition()
											.duration(2000)
											.attr('y', function(d) {return 100 - (d*2) + '%'})
											.attr('fill','black')
												.on('end', function() {
													d3.selectAll('rect')
															.transition()
															.duration(2000)
															.attr('fill','aqua')
															.attr('x', function(d) {return 100 - d + 2 + '%'})
															.attr('y', '50%')
															.attr('width', function(d) {return d * 2 + '%'}) //was height
															.attr('height', 100 / dataset.length - 1 + '%') //was width
													d3.selectAll('text')
															.transition()
															.duration(2000)
															.attr('x', 100 - d3.max(dataset) + '%')
															.attr('y', '53%') //why is the text offset?? dont forget to remove 'x' from below selectAll()
																.on('end', function() {
																	d3.selectAll('rect')
																		.transition()
																		.duration(2000)
																		.attr('y', function(d, i) {return i * (100 / dataset.length) + '%'});
																	d3.selectAll('text')
																		.transition()
																		.duration(2000)
																		.attr('fill','black')
																		.attr('y', function(d,i) {return (i * 100 / dataset.length) + ((100 / dataset.length-1)/2) + 1 + '%'})
																		.attr('x', function(d) {return 100 - d + 1 + '%'})
																			.on('end', function() {
																				d3.selectAll('rect')
																					.transition()
																					.delay(function(d,i){
																						return i * 100
																						})
																					.duration(4000)
																					//.attr('fill','maroon')
																					.attr('x', '0%')
																					.attr('fill', function(d,i){
																						return "hsl(" + Math.random(i) * 360 + ", 100%, 50%)"
																						})
																				d3.selectAll('text')
																					.transition()
																					.delay(function(d,i){
																						return i * 100
																						})
																					.duration(4000)
																					.attr('x', function(d) {return d * 2 - 1 + '%'})
																					//.duration(1000)
																					.attr('fill','white')
																						.on('end',function() {
																							d3.selectAll('rect')
																								.transition()
																								.delay(function(d,i){
																									return i * 100
																									})
																								.duration(3000)
																								.attr('width','0%')
																									.on('end', function() {
																										d3.select('svg').selectAll('circle')
																											.data(dataset)
																											.enter()
																											.append('circle')
																											.transition()
																											.attr('cx','0%')
																											.attr('cy',function(d, i) {return i * (100 / dataset.length) + 2 + '%'})
																											.attr('r','0%')
																											.attr('fill','black')
																												.on('end', function() {
																													d3.selectAll('circle')
																														.transition()
																														.delay(2000)
																														.duration(2500)
																														.attr('r', '2%')
																														.attr('cx',function(d) {return d * 2 - 1 + '%'})
																															.on('end', function() {
																																d3.selectAll('circle')
																																	.transition()
																																	.delay(1000)
																																	.duration(2000)
																																	.attr('r','0%')
																																	.attr('stroke','black').attr('stroke-width','2')
																																	.transition()
																																	.duration(2000)
																																	.attr('r',function(d){return d / 2 + '%'})
																																	.attr('fill','none')
																																d3.selectAll('text')
																																	.transition()
																																	.delay(3000)
																																	.duration(2000)
																																	.style('z-index','100')
																																	.attr('fill','black')
																																		.on('end', function() {
																																			d3.selectAll('circle')
																																				.transition()
																																				.delay(1000)
																																				.duration(2500)
																																				.attr('cx','50%')
																																				.attr('cy','50%')
																																				
																																			d3.selectAll('text')
																																				.transition()
																																				.delay(1000)
																																				.duration(2500)
																																				.attr('x','50%')
																																				.attr('y','50%')
																																				.attr('fill','white')
																																					.on('end', function() {
																																						d3.selectAll('circle')
																																							.transition()
																																							.delay(1000)
																																							.duration(4000)
																																							.attr('r','0%')
																																						d3.selectAll('text')
																																							.remove()
																																						});
																																			});
																																});
																														
																													});
																										});
																						
																							});
																				});
																	});
													});
										})
				
			
				
				
		
		
		</script>
		
	</body>


</html>